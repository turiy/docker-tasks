FROM php:7-fpm-alpine
RUN apk update
RUN apk upgrade
RUN apk add nginx php7-fpm
ENV TZ=Europe/Kiev
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone
RUN mkdir -p /etc/nginx /etc/nginx/sites-available /etc/nginx/sites-enabled /run/nginx && \
    ln -s /etc/nginx/sites-available/default.conf /etc/nginx/sites-enabled/default.conf
COPY entrypoint.sh /etc/entrypoint.sh
COPY nginx-site.conf /etc/nginx/conf.d/default.conf

COPY --chown=nginx:nginx web /var/www/mysite/web/
#RUN sed -i 's+/var/run/php-fpm/php-fpm.sock+127.0.0.1:9000+g' /etc/php-fpm.d/www.conf

WORKDIR /var/www/mysite

EXPOSE 80 443

ENTRYPOINT ["sh", "/etc/entrypoint.sh"]
